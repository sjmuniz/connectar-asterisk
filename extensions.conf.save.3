; extensions.conf - the Asterisk dial plan
;
; Static extension configuration file, used by
; the pbx_config module. This is where you configure all your
; inbound and outbound calls in Asterisk.
;
; This configuration file is reloaded
; - With the "dialplan reload" command in the CLI
; - With the "reload" command (that reloads everything) in the CLI

;
; The "General" category is for certain variables.
;
[general]
;
; If static is set to no, or omitted, then the pbx_config will rewrite
; this file when extensions are modified.  Remember that all comments
; made in the file will be lost when that happens.
;
; XXX Not yet implemented XXX
;
static=yes
;
; if static=yes and writeprotect=no, you can save dialplan by
; CLI command "dialplan save" too
;
writeprotect=no
;
; If autofallthrough is set, then if an extension runs out of
; things to do, it will terminate the call with BUSY, CONGESTION
; or HANGUP depending on Asterisk's best guess. This is the default.
;
; If autofallthrough is not set, then if an extension runs out of
; things to do, Asterisk will wait for a new extension to be dialed
; (this is the original behavior of Asterisk 1.0 and earlier).
;
;autofallthrough=no
;
;
;
; If extenpatternmatchnew is set (true, yes, etc), then a new algorithm that uses
; a Trie to find the best matching pattern is used. In dialplans
; with more than about 20-40 extensions in a single context, this
; new algorithm can provide a noticeable speedup.
; With 50 extensions, the speedup is 1.32x
; with 88 extensions, the speedup is 2.23x
; with 138 extensions, the speedup is 3.44x
; with 238 extensions, the speedup is 5.8x
; with 438 extensions, the speedup is 10.4x
; With 1000 extensions, the speedup is ~25x
; with 10,000 extensions, the speedup is 374x
; Basically, the new algorithm provides a flat response
; time, no matter the number of extensions.
;
; By default, the old pattern matcher is used.
;
; ****This is a new feature! *********************
; The new pattern matcher is for the brave, the bold, and
; the desperate. If you have large dialplans (more than about 50 extensions
; in a context), and/or high call volume, you might consider setting
; this value to "yes" !!
; Please, if you try this out, and are forced to return to the
; old pattern matcher, please report your reasons in a bug report
; on https://issues.asterisk.org. We have made good progress in providing
; something compatible with the old matcher; help us finish the job!
;
; This value can be switched at runtime using the cli command "dialplan set extenpatternmatchnew true"
; or "dialplan set extenpatternmatchnew false", so you can experiment to your hearts content.
;
;extenpatternmatchnew=no
;
; If clearglobalvars is set, global variables will be cleared
; and reparsed on a dialplan reload, or Asterisk reload.
;
; If clearglobalvars is not set, then global variables will persist
; through reloads, and even if deleted from the extensions.conf or
; one of its included files, will remain set to the previous value.
;
; NOTE: A complication sets in, if you put your global variables into
; the AEL file, instead of the extensions.conf file. With clearglobalvars
; set, a "reload" will often leave the globals vars cleared, because it
; is not unusual to have extensions.conf (which will have no globals)
; load after the extensions.ael file (where the global vars are stored).
; So, with "reload" in this particular situation, first the AEL file will
; clear and then set all the global vars, then, later, when the extensions.conf
; file is loaded, the global vars are all cleared, and then not set, because
; they are not stored in the extensions.conf file.
;
clearglobalvars=no
;
; User context is where entries from users.conf are registered.  The
; default value is 'default'
;
;userscontext=default
;
; You can include other config files, use the #include command
; (without the ';'). Note that this is different from the "include" command
; that includes contexts within other contexts. The #include command works
; in all asterisk configuration files.
;#include "filename.conf"
;#include <filename.conf>
;#include filename.conf
;
; You can execute a program or script that produces config files, and they
; will be inserted where you insert the #exec command. The #exec command
; works on all asterisk configuration files.  However, you will need to
; activate them within asterisk.conf with the "execincludes" option.  They
; are otherwise considered a security risk.
;#exec /opt/bin/build-extra-contexts.sh
;#exec /opt/bin/build-extra-contexts.sh --foo="bar"
;#exec </opt/bin/build-extra-contexts.sh --foo="bar">
;#exec "/opt/bin/build-extra-contexts.sh --foo=\"bar\""
;

; The "Globals" category contains global variables that can be referenced
; in the dialplan with the GLOBAL dialplan function:
; ${GLOBAL(VARIABLE)}
; ${${GLOBAL(VARIABLE)}} or ${text${GLOBAL(VARIABLE)}} or any hybrid
; Unix/Linux environmental variables can be reached with the ENV dialplan
; function: ${ENV(VARIABLE)}
;
[globals]
CONSOLE=Console/dsp				; Console interface for demo
;CONSOLE=DAHDI/1
;CONSOLE=Phone/phone0
IAXINFO=guest					; IAXtel username/password
;IAXINFO=myuser:mypass
TRUNK=DAHDI/G2					; Trunk interface
;
; Note the 'G2' in the TRUNK variable above. It specifies which group (defined
; in chan_dahdi.conf) to dial, i.e. group 2, and how to choose a channel to use
; in the specified group. The four possible options are:
;
; g: select the lowest-numbered non-busy DAHDI channel
;    (aka. ascending sequential hunt group).
; G: select the highest-numbered non-busy DAHDI channel
;    (aka. descending sequential hunt group).
; r: use a round-robin search, starting at the next highest channel than last
;    time (aka. ascending rotary hunt group).
; R: use a round-robin search, starting at the next lowest channel than last
;    time (aka. descending rotary hunt group).
;
TRUNKMSD=1					; MSD digits to strip (usually 1 or 0)
;TRUNK=IAX2/user:pass@provider

;FREENUMDOMAIN=mydomain.com                     ; domain to send on outbound
                                                ; freenum calls (uses outbound-freenum
                                                ; context)

;
; WARNING WARNING WARNING WARNING
; If you load any other extension configuration engine, such as pbx_ael.so,
; your global variables may be overridden by that file.  Please take care to
; use only one location to set global variables, and you will likely save
; yourself a ton of grief.
; WARNING WARNING WARNING WARNING
;
; Any category other than "General" and "Globals" represent
; extension contexts, which are collections of extensions.
;
; Extension names may be numbers, letters, or combinations
; thereof. If an extension name is prefixed by a '_'
; character, it is interpreted as a pattern rather than a
; literal.  In patterns, some characters have special meanings:
;
;   X - any digit from 0-9
;   Z - any digit from 1-9
;   N - any digit from 2-9
;   [1235-9] - any digit in the brackets (in this example, 1,2,3,5,6,7,8,9)
;   . - wildcard, matches anything remaining (e.g. _9011. matches
;	anything starting with 9011 excluding 9011 itself)
;   ! - wildcard, causes the matching process to complete as soon as
;       it can unambiguously determine that no other matches are possible
;
; For example, the extension _NXXXXXX would match normal 7 digit dialings,
; while _1NXXNXXXXXX would represent an area code plus phone number
; preceded by a one.
;
; Each step of an extension is ordered by priority, which must always start
; with 1 to be considered a valid extension.  The priority "next" or "n" means
; the previous priority plus one, regardless of whether the previous priority
; was associated with the current extension or not.  The priority "same" or "s"
; means the same as the previously specified priority, again regardless of
; whether the previous entry was for the same extension.  Priorities may be
; immediately followed by a plus sign and another integer to add that amount
; (most useful with 's' or 'n').  Priorities may then also have an alias, or
; label, in parentheses after their name which can be used in goto situations.
;
; Contexts contain several lines, one for each step of each extension.  One may
; include another context in the current one as well, optionally with a date
; and time.  Included contexts are included in the order they are listed.
; Switches may also be included within a context.  The order of matching within
; a context is always exact extensions, pattern match extensions, includes, and
; switches.  Includes are always processed depth-first.  So for example, if you
; would like a switch "A" to match before context "B", simply put switch "A" in
; an included context "C", where "C" is included in your original context
; before "B".
;
;[context]
;
;autohints = yes
; If enabled for a context, a device state hint will be automatically created in
; the context with the name of the device and updated with device state changes.
;
;exten => someexten,{priority|label{+|-}offset}[(alias)],application(arg1,arg2,...)
;
; Timing list for includes is
;
;   <time range>,<days of week>,<days of month>,<months>[,<timezone>]
;
; Note that ranges may be specified to wrap around the ends.  Also, minutes are
; fine-grained only down to the closest even minute.
;
;

[usuario]
exten => _X.,1,Dial(SIP/${EXTEN}@ss)

[from-iplan_ok]
;exten => _0115217354X,1,Goto(from-iplan_h,${EXTEN},1)
;exten =>_X.,1,Goto(from-iplan_ok,${EXTEN},1)

;exten => _0115217354[025],1,NoOp()
;exten => _0115217354[025],n,Set(DNIS=${EXTEN})
;exten => _0115217354[025],n,Goto(ivr_solnikFPBX,s,1)
exten => _01152173540,1,Goto(ivr_52173540_INTRO,s,1)
exten => _01152173545,1,Goto(ivr_52173545_INTRO,s,1)
exten => _01152173542,1,Goto(ivr_52173542,s,1)


exten => _01152173541,1,Dial(SIP/5217354101152173541@freepbx)
exten => _01152173543,1,Dial(SIP/5217354301152173543@freepbx)
exten => _01152173544,1,Dial(SIP/5217354401152173544@freepbx)
exten => _01152173546,1,Dial(SIP/5217354601152173546@freepbx)
exten => _01152173547,1,Dial(SIP/5217354701152173547@freepbx)
exten => _01152173548,1,Dial(SIP/5217354801152173548@freepbx)

exten => _12341111,1,Dial(SIP/${EXTEN}@freepbx)
exten => _12342222,1,Dial(SIP/${EXTEN}@freepbx)
exten => _12340000,1,Dial(SIP/${EXTEN}@freepbx)

exten => _12345678,1,Dial(SIP/${EXTEN}@freepbx)

[from-iplan]

exten =>__01152739133,1,Dial(SIP/12343333@freepbx)

;Horario ATM comercial
exten => _01152739134,1,GotoIfTime(*,sun,*,*?horarioATM)
exten => _01152739134,n,GotoIfTime(*,sat,*,*?horarioATM)
exten => _01152739134,n,GotoIfTime(21:00-23:59,*,*,*?horarioATM)
exten => _01152739134,n,GotoIfTime(00:00-08:59,*,*,*?horarioATM)

;Feriados ATM comercial
exten => _01152739134,n,GotoIfTime(*,*,1,jan?horarioATM)
exten => _01152739134,n,GotoIfTime(*,*,24,mar?horarioATM)
exten => _01152739134,n,GotoIfTime(*,*,1,apr?horarioATM)
exten => _01152739134,n,GotoIfTime(*,*,2,apr?horarioATM)
exten => _01152739134,n,GotoIfTime(*,*,1,may?horarioATM)
exten => _01152739134,n,GotoIfTime(*,*,24,may?horarioATM)
exten => _01152739134,n,GotoIfTime(*,*,25,may?horarioATM)
exten => _01152739134,n,GotoIfTime(*,*,20,jun?horarioATM)
exten => _01152739134,n,GotoIfTime(*,*,21,jun?horarioATM)
exten => _01152739134,n,GotoIfTime(*,*,9,jul?horarioATM)
exten => _01152739134,n,GotoIfTime(*,*,16,aug?horarioATM)
exten => _01152739134,n,GotoIfTime(*,*,8,oct?horarioATM)
exten => _01152739134,n,GotoIfTime(*,*,11,oct?horarioATM)
exten => _01152739134,n,GotoIfTime(*,*,22,nov?horarioATM)
exten => _01152739134,n,GotoIfTime(*,*,8,dec?horarioATM)
exten => _01152739134,n,GotoIfTime(*,*,24,dec?horarioATM)

;Acciones ATM Comercial
exten => _01152739134,n,Goto(ATM_COMERCIAL,s,1)
exten => _01152739134,n(horarioATM),Background(/var/lib/asterisk/sounds/ivr/INTRO_ATMCOMERCIAL_FH)
;
;Horario ATM Atencion
exten => _01152739131,1,GotoIfTime(*,sun,*,*?horarioATM1)
exten => _01152739131,n,GotoIfTime(*,sat,*,*?horarioATM1)
exten => _01152739131,n,GotoIfTime(19:00-23:59,*,*,*?horarioATM1)
exten => _01152739131,n,GotoIfTime(00:00-08:59,*,*,*?horarioATM1)

;Feriados ATM Atencion
exten => _01152739131,n,GotoIfTime(*,*,1,jan?horarioATM1)
exten => _01152739131,n,GotoIfTime(*,*,24,mar?horarioATM1)
exten => _01152739131,n,GotoIfTime(*,*,1,apr?horarioATM1)
exten => _01152739131,n,GotoIfTime(*,*,2,apr?horarioATM1)
exten => _01152739131,n,GotoIfTime(*,*,1,may?horarioATM1)
exten => _01152739131,n,GotoIfTime(*,*,24,may?horarioATM1)
exten => _01152739131,n,GotoIfTime(*,*,25,may?horarioATM1)
exten => _01152739131,n,GotoIfTime(*,*,20,jun?horarioATM1)
exten => _01152739131,n,GotoIfTime(*,*,21,jun?horarioATM1)
exten => _01152739131,n,GotoIfTime(*,*,9,jul?horarioATM1)
exten => _01152739131,n,GotoIfTime(*,*,16,aug?horarioATM1)
exten => _01152739131,n,GotoIfTime(*,*,8,oct?horarioATM1)
exten => _01152739131,n,GotoIfTime(*,*,11,oct?horarioATM1)
exten => _01152739131,n,GotoIfTime(*,*,22,nov?horarioATM1)
exten => _01152739131,n,GotoIfTime(*,*,8,dec?horarioATM1)
exten => _01152739131,n,GotoIfTime(*,*,24,dec?horarioATM1)

;Acciones ATM Atencion
exten => _01152739131,n,Goto(ivr_52739131_INTRO,s,1)
exten => _01152739131,n(horarioATM1),Dial(SIP/10001001@microvoz2)

;

;Derivaciones desde MVOZ Anular cuando liquidemos sistema.
exten => _12341111,1,Dial(SIP/${EXTEN}@freepbx)
exten => _12342222,1,Dial(SIP/${EXTEN}@freepbx)
exten => _12340000,1,Dial(SIP/${EXTEN}@freepbx)
exten => _12345678,1,Dial(SIP/${EXTEN}@freepbx)
;
;Horario Solnik (y cualquier cosa que no haya sido especificada previamente)
exten => _X.,1,GotoIfTime(*,sun,*,*?horario)
exten => _X.,n,GotoIfTime(*,sat,*,*?horario)
exten => _X.,n,GotoIfTime(18:00-23:59,*,*,*?horario)
exten => _X.,n,GotoIfTime(00:00-08:59,*,*,*?horario)

;Feriados Solnik
exten => _X.,n,GotoIfTime(*,*,1,jan?horario)
exten => _X.,n,GotoIfTime(*,*,24,mar?horario)
exten => _X.,n,GotoIfTime(*,*,1,apr?horario)
exten => _X.,n,GotoIfTime(*,*,2,apr?horario)
exten => _X.,n,GotoIfTime(*,*,1,may?horario)
exten => _X.,n,GotoIfTime(*,*,24,may?horario)
exten => _X.,n,GotoIfTime(*,*,25,may?horario)
exten => _X.,n,GotoIfTime(*,*,20,jun?horario)
exten => _X.,n,GotoIfTime(*,*,21,jun?horario)
exten => _X.,n,GotoIfTime(*,*,9,jul?horario)
exten => _X.,n,GotoIfTime(*,*,16,aug?horario)
exten => _X.,n,GotoIfTime(*,*,8,oct?horario)
exten => _X.,n,GotoIfTime(*,*,11,oct?horario)
exten => _X.,n,GotoIfTime(*,*,22,nov?horario)
exten => _X.,n,GotoIfTime(*,*,8,dec?horario)
exten => _X.,n,GotoIfTime(*,*,24,dec?horario)

;Acciones Solnik
exten => _X.,n,Goto(ivr_${EXTEN:3}_INTRO,s,1)
exten => _X.,n(horario),Background(/var/lib/asterisk/sounds/ivr/INTRO_IVR_${EXTEN:3}_FH)

exten => _01152173549,1,Goto(PRUEBA,s,1)
exten => _01152739136,1,Goto(ATM_PRODUCTORES,s,1)
exten => _01152739140,1,Goto(ATM_PRODUCTORES,s,1)

[PRUEBA]
exten => s,1,Answer(500)
exten => s,n,Dial(SIP/12343333@freepbx)

[ivr_solnikFPBX]
exten => s,1,NoOp(hola)
exten => s,n,Answer(500)
exten => s,n(loop),Background(/var/lib/asterisk/sounds/solnik)
exten => s,n,WaitExten()

exten => 1,1,Dial(SIP/52173541${DNIS}@freepbx)
exten => 2,1,Dial(SIP/52173543${DNIS}@freepbx)
exten => 3,1,Dial(SIP/52173544${DNIS}@freepbx)
exten => 4,1,Dial(SIP/52173546${DNIS}@freepbx)
exten => 5,1,Dial(SIP/52173547${DNIS}@freepbx)
exten => 6,1,Dial(SIP/52173548${DNIS}@freepbx)


[sebas1]
exten => _X.,1,Dial(SIP/${EXTEN}@sebas2)

[microvoz]
exten => _12341111,1,Dial(SIP/${EXTEN}@freepbx)
exten => _12342222,1,Dial(SIP/${EXTEN}@freepbx)
exten => _12340000,1,Dial(SIP/${EXTEN}@freepbx)
exten => _12345678,1,Dial(SIP/${EXTEN}@freepbx)

[multifon]
exten => _X.,1,AGI(/etc/asterisk/dial.pl)

exten => _9990.,1,Goto(ivr_login,${EXTEN},1_)
exten => _98,1,Dial(local/01152739134@saliente/n)
[bitrix]
exten => _X.,1,AGI(/etc/asterisk/dial.pl)

; pirueta para que queden logs en el cdr
[saliente]
exten => _X.,1,AGI(/etc/asterisk/dial.pl)

[ivr_52173540_INTRO]
exten => s,1,Answer(2000)
exten => s,n,Playback(/var/lib/asterisk/sounds/ivr/INTRO_IVR_52173540_V2)
exten => s,n,Goto(ivr_52173540,s,1)

[ivr_52173540]
exten => s,1,Background(/var/lib/asterisk/sounds/ivr/OPC_IVR_52173540_V2&/var/lib/asterisk/sounds/ivr/OPC_REP)
exten => s,n,WaitExten()

exten => 1,1,Goto(ivr_52173540_1,s,1)
exten => 2,1,Goto(ivr_52173540_2,s,1)
exten => 3,1,Dial(SIP/995217354003@freepbx)
exten => 4,1,Dial(SIP/995217354004@freepbx)
exten => 5,1,Dial(SIP/995217354005@freepbx)
exten => 6,1,Goto(ivr_52173540_6,s,1)
exten => 0,1,Goto(ivr_52173540,s,1)
exten => _x,1,Background(/var/lib/asterisk/sounds/ivr/OPC_ERROR)
exten => _x,n,Goto(ivr_52173540,s,1)


[ivr_52173540_1]
exten => s,1,Background(/var/lib/asterisk/sounds/ivr/OPC_IVR_52173540_1_V2&/var/lib/asterisk/sounds/ivr/OPC_REP)
exten => s,n,WaitExten()

exten => 1,1,Dial(SIP/995217354011@freepbx)
exten => 2,1,Dial(SIP/995217354012@freepbx)
exten => 3,1,Dial(SIP/995217354013@freepbx)
exten => 4,1,Dial(SIP/995217354014@freepbx)
exten => 5,1,Dial(SIP/995217354015@freepbx)
exten => 6,1,Dial(SIP/995217354016@freepbx)
exten => 0,1,Goto(ivr_52173540_1,s,1)
exten => _x,1,Background(/var/lib/asterisk/sounds/ivr/OPC_ERROR)
exten => _x,n,Goto(ivr_52173540_1,s,1)

[ivr_52173540_2]
exten => s,1,Background(/var/lib/asterisk/sounds/ivr/OPC_IVR_52173540_2_V3&/var/lib/asterisk/sounds/ivr/OPC_REP)
exten => s,n,WaitExten()

exten => 1,1,Dial(SIP/995217354021@freepbx)
exten => 2,1,Dial(SIP/995217354022@freepbx)
exten => 3,1,Dial(SIP/995217354023@freepbx)
exten => 4,1,Dial(SIP/995217354024@freepbx)
exten => 5,1,Dial(SIP/995217354025@freepbx)
exten => 6,1,Dial(SIP/995217354026@freepbx)

exten => 0,1,Goto(ivr_52173540_2,s,1)
exten => _x,1,Background(/var/lib/asterisk/sounds/ivr/OPC_ERROR)
exten => _x,n,Goto(ivr_52173540_2,s,1)


[ivr_52173540_6]
exten => s,1,Background(/var/lib/asterisk/sounds/ivr/OPC_IVR_52173545_V2&/var/lib/asterisk/sounds/ivr/OPC_REP)
exten => s,n,WaitExten()

exten => 1,1,Dial(SIP/995217354061@freepbx)
exten => 2,1,Dial(SIP/995217354062@freepbx)
exten => 3,1,Dial(SIP/995217354063@freepbx)
exten => 0,1,Goto(ivr_52173540_6,s,1)
exten => _x,1,Background(/var/lib/asterisk/sounds/ivr/OPC_ERROR)
exten => _x,n,Goto(ivr_52173540_6,s,1)


[ivr_52173545_INTRO]
;Cambios hechos aqui reflejarlos tambien en exten 6 en IVR 52173540
exten => s,1,Answer(500)
exten => s,n,Background(/var/lib/asterisk/sounds/ivr/INTRO_IVR_52173545_V2)
exten => s,n,Goto(ivr_52173545,s,1)

[ivr_52173545]
exten => s,1,Background(/var/lib/asterisk/sounds/ivr/OPC_IVR_52173545_V2&/var/lib/asterisk/sounds/ivr/OPC_REP)
exten => s,n,WaitExten()

exten => 1,1,Dial(SIP/995217354501@freepbx)
exten => 2,1,Dial(SIP/995217354502@freepbx)
exten => 3,1,Dial(SIP/995217354503@freepbx)
exten => 0,1,Goto(ivr_52173545,s,1)
exten => _x,1,Background(/var/lib/asterisk/sounds/ivr/OPC_ERROR)
exten => _x,n,Goto(ivr_52173545,s,1)


[ivr_52173542_INTRO]
;Cambios hechos aqui reflejarlos tambien en exten 3  en IVR 52173540
exten => s,1,Answer(500)
exten => s,n,Background(/var/lib/asterisk/sounds/ivr/INTRO_IVR_52173542_V2)
exten => s,n,Dial(SIP/995217354200@freepbx)

[ivr_52177920_INTRO]
exten => s,1,Answer(500)
exten => s,n,Playback(/var/lib/asterisk/sounds/ivr/INTRO_IVR_52177920)
exten => s,n,Goto(ivr_52177920,s,1)

[ivr_52177920]
exten => s,1,Answer(500)
exten => s,n,Background(/var/lib/asterisk/sounds/ivr/OPC_IVR_52177920_V3&/var/lib/asterisk/sounds/ivr/OPC_REP)
exten => s,n,WaitExten()
exten => 1,1,Dial(SIP/995217792001@freepbx)
exten => 2,1,Dial(SIP/995217792002@freepbx)
exten => 3,1,Dial(SIP/995217792003@freepbx)
exten => 4,1,Dial(SIP/995217792004@freepbx)
exten => 5,1,Dial(SIP/995217792005@freepbx)
exten => 6,1,Dial(SIP/995217792006@freepbx)
exten => 0,1,Goto(ivr_52177920,s,1)
exten => _x,1,Background(/var/lib/asterisk/sounds/ivr/OPC_ERROR)
exten => _x,n,Goto(ivr_52177920,s,1)




[ATM_COMERCIAL]
exten => s,1,Answer(500)
exten => s,n,Background(/var/lib/asterisk/sounds/ivr/INTRO_ATM_COMERCIAL&/var/lib/asterisk/sounds/ivr/OPC_ATM_COMERCIAL)
exten => s,n,WaitExten()

exten => 1,1,Dial(SIP/12345678@freepbx)
exten => 2,1,Dial(SIP/12341111@freepbx)

[ATM_PRODUCTORES]
exten => s,1,Answer(500)
exten => s,n,Background(/var/lib/asterisk/sounds/ivr/INTRO_IVR_52739136_V1)
exten => s,n,Dial(SIP/12344444@freepbx)
;exten => s,n,Dial(SIP/10001006@microvoz2)

;ATM Customer
[ivr_52739131_INTRO]
exten => s,1,Answer(2000)
exten => s,n,Playback(/var/lib/asterisk/sounds/ivr/INTRO_52739131)
exten => s,n,Goto(ivr_52739131,s,1)

[ivr_52739131]
exten => s,1,Background(/var/lib/asterisk/sounds/ivr/OPC_52739131)
exten => s,n,WaitExten()

exten => 1,1,Set(CDR(userfield)=${CDR(userfield)}:${EXTEN})
exten => 1,n,Goto(ivr_52739131_DNI,s,1)

exten => 2,1,Set(CDR(userfield)=${CDR(userfield)}:${EXTEN})
;exten => 2,n,Dial(SIP/10001003@microvoz2)
exten => 2,n,Dial(SIP/12343333@freepbx)

exten => 3,1,Set(CDR(userfield)=${CDR(userfield)}:${EXTEN})
exten => 3,n,Dial(SIP/12343333@freepbx)
;exten => 3,n,Dial(SIP/10001004@microvoz2)

[ivr_52739131_DNI]
exten => s,1,Set(TIMEOUT(digit)=5)
exten => s,n,NoOp(TIMEOUT ${TIMEOUT(digit)})
exten => s,n,Background(/var/lib/asterisk/sounds/ivr/DNI_52739131)
exten => s,n,WaitExten()

exten => _X.,1,NoOp(DNI ${EXTEN})
exten => _X.,n,Set(CDR(userfield)=${CDR(userfield)}:${EXTEN})
exten => _X.,n,NoOp(TIMEOUT ${TIMEOUT(digit)})
exten => _X.,n,MySQL(connect connid localhost asterisk colaciones asterisk)
exten => _X.,n,MySQL(query resultid ${connid} select count(*) C from atm where dni='${EXTEN}')
exten => _X.,n,MySQL(fetch fetchid ${resultid} DNI)
exten => _X.,n,MySQL(clear ${resultid})
exten => _X.,n,MySQL(disconnect ${connid})

exten => _X.,n,GotoIf($["${DNI}" = "1"]?quiroga:otros)

exten => _X.,n(quiroga),Set(CDR(userfield)=${CDR(userfield)}:quiroga)
exten => _X.,n,Dial(local/01139870453@saliente/n)
exten => _X.,n,Hangup()

exten => _X.,n(otros),Dial(SIP/12343333@freepbx)
;exten => _X.,n(otros),Dial(SIP/10001002@microvoz2)
exten => _X.,n,Hangup()

[ivr_login]

exten => _X.,1,MySQL(connect connid localhost asterisk colaciones asterisk)
exten => _X.,n,MySQL(query resultid ${connid} insert into login (user, tipo) values ('${CALLERID(num)}', '${EXTEN}') )
exten => _X.,n,MySQL(disconnect ${connid})
exten => _X.,n,Background(/var/lib/asterisk/sounds/ivr/login_${EXTEN:0:5})


